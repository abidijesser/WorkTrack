import{r as u,u as S,x as w,y as n,B as h,j as e,a as i,b as a,c as E,z as N,d as B,e as P,f as g,bN as A,U as p,i as k}from"./index-D6BHh2cn.js";const _=()=>{const[s,m]=u.useState({title:"",description:"",status:"To Do",priority:"Medium",dueDate:"",assignedTo:"",project:""}),[v,C]=u.useState([]),[f,y]=u.useState([]),x=S(),{id:j}=w();u.useEffect(()=>{T(),b()},[j]);const T=async()=>{var r,t;try{const c=localStorage.getItem("token");if(!c){n.error("No authentication token found");return}const l=await h.get(`https://worktrack-server-muu6.onrender.com/api/tasks/${j}`,{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});if(l.data&&l.data.success&&l.data.task){const d=l.data.task;m({...d,dueDate:d.dueDate?new Date(d.dueDate).toISOString().split("T")[0]:"",assignedTo:((r=d.assignedTo)==null?void 0:r._id)||"",project:((t=d.project)==null?void 0:t._id)||""})}else throw new Error("Task data not found or invalid response format")}catch(c){console.error("Erreur lors de la récupération de la tâche:",c),n.error("Erreur lors de la récupération de la tâche.")}},b=async()=>{try{const r=localStorage.getItem("token");if(!r){n.error("No authentication token found");return}const t={headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}},[c,l]=await Promise.all([h.get("https://worktrack-server-muu6.onrender.com/api/projects",t),h.get("https://worktrack-server-muu6.onrender.com/api/auth/users",t)]);C(c.data.projects||[]),y(l.data.users||[])}catch(r){console.error("Erreur lors de la récupération des projets ou utilisateurs:",r),n.error("Erreur lors de la récupération des projets ou utilisateurs.")}},o=r=>{m({...s,[r.target.name]:r.target.value})},D=async r=>{r.preventDefault();try{const t=localStorage.getItem("token");if(!t){n.error("No authentication token found");return}await h.put(`https://worktrack-server-muu6.onrender.com/api/tasks/${j}`,s,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),n.success("Tâche modifiée avec succès !"),x("/tasks")}catch(t){console.error("Erreur lors de la modification de la tâche:",t),n.error("Erreur lors de la modification de la tâche.")}};return e.jsx(i,{children:e.jsx(a,{children:e.jsxs(E,{children:[e.jsx(N,{children:e.jsx("strong",{children:"Modifier la tâche"})}),e.jsx(B,{children:e.jsxs(P,{onSubmit:D,children:[e.jsx(i,{className:"mb-3",children:e.jsx(a,{children:e.jsx(g,{label:"Titre",name:"title",value:s.title,onChange:o,required:!0})})}),e.jsx(i,{className:"mb-3",children:e.jsx(a,{children:e.jsx(A,{label:"Description",name:"description",value:s.description,onChange:o,required:!0})})}),e.jsxs(i,{className:"mb-3",children:[e.jsx(a,{children:e.jsxs(p,{label:"Statut",name:"status",value:s.status,onChange:o,children:[e.jsx("option",{value:"To Do",children:"À faire"}),e.jsx("option",{value:"In Progress",children:"En cours"}),e.jsx("option",{value:"Done",children:"Terminé"})]})}),e.jsx(a,{children:e.jsxs(p,{label:"Priorité",name:"priority",value:s.priority,onChange:o,children:[e.jsx("option",{value:"Low",children:"Basse"}),e.jsx("option",{value:"Medium",children:"Moyenne"}),e.jsx("option",{value:"High",children:"Haute"})]})})]}),e.jsxs(i,{className:"mb-3",children:[e.jsx(a,{children:e.jsx(g,{type:"date",label:"Date d'échéance",name:"dueDate",value:s.dueDate,onChange:o})}),e.jsx(a,{children:e.jsxs(p,{label:"Assigné à",name:"assignedTo",value:s.assignedTo,onChange:o,children:[e.jsx("option",{value:"",children:"Sélectionner un utilisateur"}),f.map(r=>e.jsxs("option",{value:r._id,children:[r.name," (",r.email,")"]},r._id))]})})]}),e.jsx(i,{className:"mb-3",children:e.jsx(a,{children:e.jsxs(p,{label:"Projet",name:"project",value:s.project,onChange:o,children:[e.jsx("option",{value:"",children:"Sélectionner un projet"}),v.map(r=>e.jsx("option",{value:r._id,children:r.projectName},r._id))]})})}),e.jsx(i,{children:e.jsxs(a,{children:[e.jsx(k,{type:"submit",color:"primary",children:"Modifier"}),e.jsx(k,{type:"button",color:"secondary",className:"ms-2",onClick:()=>x("/tasks"),children:"Annuler"})]})})]})})]})})})};export{_ as default};
